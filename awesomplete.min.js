// Awesomplete - Lea Verou - MIT license
(function(){function l(a,b){for(var d in a){var f=a[d],c=this.input.getAttribute("data-"+d.toLowerCase());this[d]="number"===typeof f?parseInt(c):!1===f?null!==c:f instanceof Function?null:c;this[d]||0===this[d]||(this[d]=d in b?b[d]:f)}}function c(a,b){return"string"===typeof a?(b||document).querySelector(a):a||null}function g(a,b){return h.call((b||document).querySelectorAll(a))}function k(){g("input.awesomplete").forEach(function(a){new Awesomplete(a)})}var e=function(a,b){var d=this;this.input=
c(a);this.input.setAttribute("autocomplete","off");this.input.setAttribute("aria-autocomplete","list");b=b||{};l.call(this,{minChars:2,maxItems:10,autoFirst:!1,filter:e.FILTER_CONTAINS,sort:e.SORT_BYLENGTH,item:function(a,b){return c.create("li",{innerHTML:a.replace(RegExp(c.regExpEscape(b.trim()),"gi"),"<mark>$&</mark>"),"aria-selected":"false"})},replace:function(a){this.input.value=a}},b);this.index=-1;this.lastValue="";this.container=c.create("div",{className:"awesomplete",around:a});this.ul=
c.create("ul",{hidden:"",inside:this.container});this.status=c.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container});c.bind(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this),keyup:this.change.bind(this),keydown:function(a){var b=a.keyCode;if(d.opened)if(13===b&&d.selected)a.preventDefault(),d.select();else if(27===b)d.close();else if(38===b||40===b)a.preventDefault(),d[38===b?"previous":"next"]()}});
c.bind(this.input.form,{submit:this.close.bind(this)});c.bind(this.ul,{mousedown:function(a){a=a.target;if(a!==this){for(;a&&!/li/i.test(a.nodeName);)a=a.parentNode;a&&d.select(a)}}});this.input.hasAttribute("list")?(this.list="#"+a.getAttribute("list"),a.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||b.list||[];e.all.push(this)};e.prototype={set list(a){Array.isArray(a)?this._list=a:"string"===typeof a&&-1<a.indexOf(",")?this._list=a.split(/\s*,\s*/):(a=c(a))&&a.children&&
(this._list=h.apply(a.children).map(function(a){return a.textContent.trim()}));document.activeElement===this.input&&this.evaluate()},get selected(){return-1<this.index},get opened(){return this.ul&&null==this.ul.getAttribute("hidden")},close:function(){this.ul.setAttribute("hidden","");this.index=-1;c.fire(this.input,"awesomplete-close")},change:function(){var a=this.input.value.trim();a!==this.lastValue&&(c.fire(this.input,"awesomplete-change",{newValue:a}),this.lastValue=a)},open:function(){this.ul.removeAttribute("hidden");
this.autoFirst&&-1===this.index&&this.goto(0);c.fire(this.input,"awesomplete-open")},next:function(){this.goto(this.index<this.ul.children.length-1?this.index+1:-1)},previous:function(){var a=this.ul.children.length;this.goto(this.selected?this.index-1:a-1)},goto:function(a){var b=this.ul.children;this.selected&&b[this.index].setAttribute("aria-selected","false");this.index=a;-1<a&&0<b.length&&(b[a].setAttribute("aria-selected","true"),this.status.textContent=b[a].textContent);c.fire(this.input,"awesomplete-highlight")},
select:function(a){if(a=a||this.ul.children[this.index]){var b;c.fire(this.input,"awesomplete-select",{text:a.textContent,selected:a,preventDefault:function(){b=!0}});b||(this.replace(a.textContent),this.close(),c.fire(this.input,"awesomplete-selectcomplete"))}},evaluate:function(){var a=this,b=this.input.value;b.length>=this.minChars&&0<this._list.length?(this.index=-1,this.ul.innerHTML="",this._list.filter(function(d){return a.filter(d,b)}).sort(this.sort).every(function(d,c){a.ul.appendChild(a.item(d,
b));return c<a.maxItems-1}),0===this.ul.children.length?this.close():this.open()):this.close()},setValue:function(a){this.lastValue=this.input.value=a}};e.all=[];e.FILTER_CONTAINS=function(a,b){return RegExp(c.regExpEscape(b.trim()),"i").test(a)};e.FILTER_STARTSWITH=function(a,b){return RegExp("^"+c.regExpEscape(b.trim()),"i").test(a)};e.SORT_BYLENGTH=function(a,b){return a.length!==b.length?a.length-b.length:a<b?-1:1};var h=Array.prototype.slice;c.create=function(a,b){var d=document.createElement(a),
f;for(f in b){var e=b[f];"inside"===f?c(e).appendChild(d):"around"===f?(e=c(e),e.parentNode.insertBefore(d,e),d.appendChild(e)):f in d?d[f]=e:d.setAttribute(f,e)}return d};c.bind=function(a,b){if(a)for(var d in b){var c=b[d];d.split(/\s+/).forEach(function(b){a.addEventListener(b,c)})}};c.fire=function(a,b,c){var e=document.createEvent("HTMLEvents");e.initEvent(b,!0,!0);for(var g in c)e[g]=c[g];a.dispatchEvent(e)};c.regExpEscape=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};"undefined"!==
typeof Document&&("loading"!==document.readyState?k():document.addEventListener("DOMContentLoaded",k));e.$=c;e.$$=g;"undefined"!==typeof self&&(self.Awesomplete=e);"object"===typeof exports&&(module.exports=e);return e})();
